# Serial-Studio 可视化组件数据格式规范

## 概述

Serial-Studio 提供了丰富的可视化组件系统，包含13个不同类型的组件，每个组件都有特定的数据格式要求和配置方式。本文档作为组件数据格式的总体规范和索引，具体组件的详细配置信息请参考 `docs/data/Widget/` 目录下的各组件专门文档。

## 1. 组件架构和分类

Serial-Studio 组件系统基于源代码中的三种枚举类型进行分类：

### 1.1 组件类型映射

基于 `Serial-Studio/app/src/SerialStudio.h` 和 `Serial-Studio/app/src/UI/DashboardWidget.cpp` 的分析，组件映射关系如下：

| 枚举值 | 组件类型 | QML文件 | 文档链接 |
|--------|----------|---------|----------|
| `DashboardDataGrid` | 数据网格 | DataGrid.qml | [DataGrid.md](./Widget/DataGrid.md) |
| `DashboardMultiPlot` | 多线图 | MultiPlot.qml | [MultiPlot.md](./Widget/MultiPlot.md) |
| `DashboardFFT` | FFT频谱 | FFTPlot.qml | [FFTPlot.md](./Widget/FFTPlot.md) |
| `DashboardPlot` | 单线图 | Plot.qml | [Plot.md](./Widget/Plot.md) |
| `DashboardBar` | 条形图 | Bar.qml | [Bar.md](./Widget/Bar.md) |
| `DashboardGauge` | 仪表盘 | Gauge.qml | [Gauge.md](./Widget/Gauge.md) |
| `DashboardCompass` | 指南针 | Compass.qml | [Compass.md](./Widget/Compass.md) |
| `DashboardGyroscope` | 陀螺仪 | Gyroscope.qml | [Gyroscope.md](./Widget/Gyroscope.md) |
| `DashboardAccelerometer` | 加速度计 | Accelerometer.qml | [Accelerometer.md](./Widget/Accelerometer.md) |
| `DashboardTerminal` | 终端 | Terminal.qml | [Terminal.md](./Widget/Terminal.md) |
| `DashboardGPS` | GPS地图 | GPS.qml | [GPS.md](./Widget/GPS.md) |
| `DashboardLED` | LED面板 | LEDPanel.qml | [LEDPanel.md](./Widget/LEDPanel.md) |
| `DashboardPlot3D` | 3D图表* | Plot3D.qml | [Plot3D.md](./Widget/Plot3D.md) |

*\* 3D图表组件仅在商业版中可用 (`#ifdef BUILD_COMMERCIAL`)*

### 1.2 数据集选项 (DatasetOption)

```cpp
enum DatasetOption {
    DatasetGeneric = 0b00000000, // 通用数据
    DatasetPlot    = 0b00000001, // 图表数据
    DatasetFFT     = 0b00000010, // FFT数据
    DatasetBar     = 0b00000100, // 条形图数据
    DatasetGauge   = 0b00001000, // 仪表盘数据
    DatasetCompass = 0b00010000, // 指南针数据
    DatasetLED     = 0b00100000, // LED数据
};
```

## 2. 组件分类指南

### 2.1 运动传感器组件

专为IMU传感器和运动检测设计的组件：

- **[加速度计组件 (Accelerometer)](./Widget/Accelerometer.md)** - 三轴加速度矢量可视化，自动计算倾斜角度和加速度幅值
- **[陀螺仪组件 (Gyroscope)](./Widget/Gyroscope.md)** - 三轴角速度数据和3D姿态指示器
- **[指南针组件 (Compass)](./Widget/Compass.md)** - 磁北方向角度显示，支持0-360°范围

### 2.2 测量显示组件

用于单一数值的直观显示：

- **[仪表盘组件 (Gauge)](./Widget/Gauge.md)** - 模拟圆形仪表，支持刻度、报警区域和动画效果
- **[条形图组件 (Bar)](./Widget/Bar.md)** - 水平/垂直条形进度显示，支持渐变和报警色
- **[LED面板组件 (LEDPanel)](./Widget/LEDPanel.md)** - 多状态LED指示器矩阵

### 2.3 时序数据图表组件

专为时间序列数据设计的绘图组件：

- **[单线图组件 (Plot)](./Widget/Plot.md)** - 实时数据曲线绘制，支持自动缩放和历史回放
- **[多线图组件 (MultiPlot)](./Widget/MultiPlot.md)** - 多数据源同屏对比，支持独立Y轴缩放
- **[FFT频谱图组件 (FFTPlot)](./Widget/FFTPlot.md)** - 信号频域分析，实时FFT变换和频谱显示

### 2.4 地理和数据展示组件

- **[GPS地图组件 (GPS)](./Widget/GPS.md)** - 基于OpenStreetMap的位置显示，支持轨迹记录
- **[数据网格组件 (DataGrid)](./Widget/DataGrid.md)** - 表格形式的数据总览，支持多列显示和实时更新
- **[终端组件 (Terminal)](./Widget/Terminal.md)** - VT-100终端仿真，支持ANSI转义序列和彩色输出

### 2.5 高级组件（商业版）

- **[3D图表组件 (Plot3D)](./Widget/Plot3D.md)** - 三维数据点云可视化，支持旋转和缩放交互

## 3. 通用数据格式标准

### 3.1 数据帧协议

所有组件都使用统一的数据帧格式：

```
$数值1,数值2,数值3,...;
```

**协议要求：**
- 起始符：`$`
- 分隔符：`,` （逗号）
- 终止符：`;` （分号）
- 数值顺序必须与配置文件中的 `index` 字段对应

### 3.2 JSON配置模板

```json
{
    "title": "组件标题",
    "widget": "组件类型标识",
    "datasets": [
        {
            "title": "数据集名称",
            "units": "单位",
            "widget": "数据集类型",
            "index": 1,
            "graph": true,
            "min": 0,
            "max": 100,
            "alarm": 80
        }
    ]
}
```

### 3.3 配置参数说明

| 参数 | 类型 | 必需 | 说明 | 适用组件 |
|------|------|------|------|----------|
| `title` | string | ✓ | 显示标题 | 所有组件 |
| `widget` | string | ✓ | 组件类型标识 | 所有组件 |
| `units` | string |  | 数据单位 | 大部分组件 |
| `index` | int | ✓ | 数据帧索引位置 | 所有组件 |
| `graph` | bool |  | 是否在图表中显示 | 图表类组件 |
| `min` / `max` | double |  | 数值范围 | Gauge, Bar |
| `alarm` | double |  | 报警阈值 | Gauge, Bar |
| `fft` | bool |  | FFT变换标志 | FFTPlot |
| `led` | bool |  | LED显示标志 | LEDPanel |

## 4. 最佳实践和建议

### 4.1 数据更新频率建议

根据组件特性和性能要求：

- **高频数据 (>50Hz)**: Accelerometer, Gyroscope, FFTPlot
- **中频数据 (1-50Hz)**: Plot, MultiPlot, Gauge, Bar
- **低频数据 (<1Hz)**: GPS, DataGrid, Terminal

### 4.2 性能优化建议

1. **内存管理**: 使用环形缓冲区，限制历史数据量
2. **渲染优化**: 按需更新，避免不必要的重绘
3. **数据预处理**: 在数据源端进行滤波和预处理

### 4.3 数据验证范围

关键数值的有效范围（详见各组件文档）：

- **加速度计**: ±20 m/s² (常规) / ±200 m/s² (高冲击)
- **陀螺仪**: ±2000 deg/s
- **GPS纬度**: -90° ~ +90°
- **GPS经度**: -180° ~ +180°
- **指南针**: 0° ~ 360°

## 5. 错误诊断和调试

### 5.1 常见配置错误

1. **widget类型不匹配**: 检查组件类型标识是否正确
2. **index索引冲突**: 确保同一帧内索引值唯一
3. **数据范围错误**: 验证min/max设置合理性
4. **数据集缺失**: 检查必需的数据集是否完整

### 5.2 数据格式调试

```bash
# 正确格式示例
$25.6,60.2,1013.25;    # 温度,湿度,压力

# 错误格式示例  
25.6,60.2,1013.25      # 缺少$和;
$25.6|60.2|1013.25;    # 错误分隔符
$25.6,60.2,;           # 数据不完整
```

## 6. 快速参考

### 6.1 组件选择指南

| 数据类型 | 推荐组件 | 备注 |
|----------|----------|------|
| 单一数值 | Gauge, Bar | 支持范围和报警 |
| 时间序列 | Plot, MultiPlot | 实时曲线绘制 |
| 频域分析 | FFTPlot | 需要数值数据 |
| 3轴运动数据 | Accelerometer, Gyroscope | 专用传感器组件 |
| 方向角度 | Compass | 0-360°范围 |
| 地理位置 | GPS | 需要经纬度数据 |
| 状态指示 | LEDPanel | 多状态显示 |
| 原始数据 | Terminal | 文本和调试输出 |
| 表格数据 | DataGrid | 多列数据总览 |

### 6.2 配置文件模板

完整的多组件配置示例请参考各Widget文档中的"示例项目配置"章节。

---

**注意**: 本文档提供总体规范和快速索引。各组件的详细配置参数、数据格式要求、使用示例和故障排除，请参考 `docs/data/Widget/` 目录下对应的组件文档。
